load '~/code/aoc/aoc.ijs'

in=: 'L'&= ;._2 aoc 2020 11

S =: ((0=])+.[*.4>])[:+/(<:3 3#:(i.9)-.4)|.!.0]
NB. alternate, but slower: s =: {{y>:0 3 I. +/(<:3 3#:(i.9)-.4)|.!.0/y}}
+/,(in*.S)^:_ in

Z =: [: < 2 <\ (#~ {&in)
G =. (,|."1)>;(Z/.J),(Z/.|.J),Z"1 J,|:J=:{;~i.#in
G =: (([:<{:"1)/.~{."1)(i.~[:~.{."1) G
T =: {{(z=0)+.y*.5>z=.([:+/{&y)&>G}}
+/ T^:_ (#G)$0
